#!/bin/bash
# Run the undercloud install

set -eux

{% for var in (undercloud_env_vars|default([])) %}
export {{ var }}
{% endfor %}

# Ironic defaults to using qemu:///system.  When running libvirtd
# unprivileged we need to use qemu:///session.  This allows us to pass
# the value of libvirt_uri into /etc/ironic/ironic.conf.
sudo crudini --set \
    /etc/ironic/ironic.conf \
    ssh \
    libvirt_uri \
    '{{ libvirt_uri }}'

openstack undercloud install
