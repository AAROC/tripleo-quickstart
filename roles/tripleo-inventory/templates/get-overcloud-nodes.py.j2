#!/usr/bin/env python

import json
import os

from novaclient import client
from novaclient import __version__ as nc_version

# We can remove this logic when newton (novaclient 6) is EOL
if nc_version[0] <= "6":
    nova = client.Client(2,
                         os.environ.get("OS_USERNAME"),
                         os.environ.get("OS_PASSWORD"),
                         os.environ.get("OS_TENANT_NAME"),
                         auth_url=os.environ.get("OS_AUTH_URL"))
else:
    nova = client.Client(2,
                         os.environ.get("OS_USERNAME"),
                         os.environ.get("OS_PASSWORD"),
                         project_name=os.environ.get("OS_TENANT_NAME"),
                         auth_url=os.environ.get("OS_AUTH_URL"))

oc_servers = {server.name: server.networks['ctlplane'][0]
              for server in nova.servers.list()
              if server.networks.get('ctlplane')}
print(json.dumps(oc_servers, indent=4))
